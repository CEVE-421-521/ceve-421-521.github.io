<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;James Doss-Gollin">

<title>CEVE 421/521 – Spring 2024 - Cost-Benefit Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- MathJax 3 -->
<script>
window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="CEVE 421/521 – Spring 2024 - Cost-Benefit Analysis">
<meta property="og:description" content="Lecture">
<meta property="og:site_name" content="CEVE 421/521 -- Spring 2024">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#quantifying-costs-and-benefits" id="toc-quantifying-costs-and-benefits" class="nav-link" data-scroll-target="#quantifying-costs-and-benefits">Quantifying costs and benefits</a>
  <ul class="collapse">
  <li><a href="#dealing-with-time" id="toc-dealing-with-time" class="nav-link" data-scroll-target="#dealing-with-time">Dealing with time</a></li>
  <li><a href="#cost-benefit-analysis-in-the-real-world" id="toc-cost-benefit-analysis-in-the-real-world" class="nav-link" data-scroll-target="#cost-benefit-analysis-in-the-real-world">Cost-benefit analysis in the real world</a></li>
  </ul></li>
  <li><a href="#handling-uncertainty" id="toc-handling-uncertainty" class="nav-link" data-scroll-target="#handling-uncertainty">Handling uncertainty</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a>
  <ul class="collapse">
  <li><a href="#critiques-and-limitations" id="toc-critiques-and-limitations" class="nav-link" data-scroll-target="#critiques-and-limitations">Critiques and limitations</a></li>
  <li><a href="#a-defense" id="toc-a-defense" class="nav-link" data-scroll-target="#a-defense">A defense</a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next steps</a>
  <ul class="collapse">
  <li><a href="#wednesday" id="toc-wednesday" class="nav-link" data-scroll-target="#wednesday">Wednesday</a></li>
  <li><a href="#thursday" id="toc-thursday" class="nav-link" data-scroll-target="#thursday">Thursday</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://www.github.com/ceve-421-521/ceve-421-521.github.io/edit/main/lectures/05-bca.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://www.github.com/ceve-421-521/ceve-421-521.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="05-bca.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cost-Benefit Analysis</h1>
<p class="subtitle lead">Lecture</p>
  <div class="quarto-categories">
    <div class="quarto-category">Lecture</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;James Doss-Gollin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Mon., Feb.&nbsp;5</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="motivation" class="level1">
<h1>Motivation</h1>
<p>We often want a quantitative way to compare two or more decisions. Hence, cost-benefit analysis.</p>
<p>It’s a simple idea. For a given “decision” (being deliberately vague about what we mean by this), we need some function that tells us how good or bad the decision is. Then, we can compare the goodness of different decisions.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>As a motivating example, consider that we are have been asked to help a homeowner decide whether to elevate their home by 5ft to protect against future flooding, or whether to leave it as-is.</p>
</div>
</div>
</div>
<div id="fig-floodproofing" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-floodproofing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../_assets/img/lee-meyerland-elevation.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-floodproofing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Floodproofing in Houston, TX (<a href="https://www.houstonpublicmedia.org/articles/news/2017/10/06/240934/many-houstonians-seek-home-elevation-after-repetitive-flooding/">Houston Public Media</a>)
</figcaption>
</figure>
</div>
</section>
<section id="quantifying-costs-and-benefits" class="level1">
<h1>Quantifying costs and benefits</h1>
<p>We want to pick the decision that maximizes the “goodness” of the decision. We’ll call this a “utility” function, but could also use “objective function”, “loss function”, “damage function”, etc. Let’s give this some formal notation: <span class="math display">\[
u(a, \mathbf{s}): \mathcal{A} \times \mathcal{S} \to \mathbb{R}
\]</span> where <span class="math inline">\(u\)</span> is the utility function, <span class="math inline">\(a \in \mathcal{A}\)</span> is the decision, and <span class="math inline">\(\mathbf{s} \in \mathcal{S}\)</span> is the state of the world.</p>
<ul>
<li>We’ll use “state of the world” as a deliberately vague term that we will use to describe all the uncertainties we want to think about when making a decision.</li>
<li>You can remember that <span class="math inline">\(a\)</span> is the decision because it’s the first letter of “action”.</li>
</ul>
<p>Often, utility is measured in money. This is not because money is the only thing that matters, but because it is a common unit of account that allows us to compare different things. However, utility can be measured in other units as well – it only requires that we put all the costs and benefits into a common unit.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In our house elevation example, we might consider the following costs and benefits: up-front cost of elevating; cost of flood insurance; change in property value; and cost of damages not covered by flood insurance. These might be well-described in monetary terms. However, putting a value on the peace of mind from not having to worry about future flooding, or the reduced risk of death, is trickier.</p>
</div>
</div>
</div>
<section id="dealing-with-time" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-time">Dealing with time</h2>
<p>A key feature of nearly all climate adaptation problems is that costs and benefits are spread out over time. How should we weigh costs and benefits that occur at different times?</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>For example, the up-front cost of elevating a house is a cost that occurs now, while the benefits of reduced flood risk occur in the future.</p>
</div>
</div>
</div>
<p>The most common way to deal with this is to use net present value (NPV). The idea is to <strong>discount</strong> future costs and benefits to the present day. If our discount rate is <span class="math inline">\(\gamma = 2\% = 0.02\)</span>, then we care about a dollar of benefits in one year the same as we care about 98 cents today. More generally, if we have a discount rate of <span class="math inline">\(\gamma\)</span> then a dollar of benefits in <span class="math inline">\(t\)</span> years is worth <span class="math inline">\((1 - \gamma) ^ t\)</span> today.</p>
<p>The net present value of a decision is the sum of the present values of all costs and benefits: <span class="math display">\[
NPV = \sum_{t=0}^T (1 - \gamma)^t u(a, \mathbf{s}_t)
\]</span> where <span class="math inline">\(T\)</span> is the time horizon of the decision. Note that we write <span class="math inline">\(\mathbf{s}_t\)</span> to indicate that the state of the world might have time-dependent variables.</p>
</section>
<section id="cost-benefit-analysis-in-the-real-world" class="level2">
<h2 class="anchored" data-anchor-id="cost-benefit-analysis-in-the-real-world">Cost-benefit analysis in the real world</h2>
<p>Cost-benefit analysis is everywhere! Companies use it to decide whether to invest in new products or technologies, governments use it to decide whether to build new infrastructure or regulate pollution, and much more!</p>
<p>A standard approach is:</p>
<ol type="1">
<li>Come up with a state of the world <span class="math inline">\(\mathbf{s}\)</span> that represents your uncertainties.</li>
<li>Write down a utility function <span class="math inline">\(u(a, \mathbf{s})\)</span> that represents your preferences.</li>
<li>Choose a discount rate <span class="math inline">\(\gamma\)</span></li>
<li>Calculate the net present value of each decision</li>
<li>Pick the decision with the highest net present value</li>
</ol>
</section>
</section>
<section id="handling-uncertainty" class="level1">
<h1>Handling uncertainty</h1>
<p>Bayesian decision theory is a mathematical formalization of a simple concept: decision that gives us the best utility <strong>on average</strong> (i.e., in expectation):</p>
<p><span class="math display">\[
a^* = \arg \max_a \mathbb{E}_\mathbf{s} \left[ u(a, \mathbf{s}) \right]
\]</span> where <span class="math inline">\(a \in \mathcal{A}\)</span> is the decision, <span class="math inline">\(\mathbf{s} \in \mathcal{S}\)</span> is the <strong>state of the world</strong>, and <span class="math inline">\(u: \mathcal{A} \times \mathcal{S} \to \mathbb{R}\)</span> is a utility function. “State of the world” is another deliberately vague term that we will use to describe all the uncertainties we want to think about when making a decision.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>For our house elevation problem, a very simple framing would consider the state of the world to be the time series of future flood levels. A more complex framing might also consider the depth-damage function for the house, the cost of elevating the house, the cost of rebuilding a house over time, etc. etc.</p>
</div>
</div>
</div>
<p>Recall the definition of expected value: <span class="math display">\[
\mathbb{E}_\mathbf{s} \left[ u(a, \mathbf{s}) \right] = \int p(\mathbf{s}) u(a, \mathbf{s}) d\mathbf{s}
\]</span> which requires a probability distribution over states of the world. So applying this theory requires a “subjective” <span class="citation" data-cites="savage:1954">(<a href="#ref-savage:1954" role="doc-biblioref">Savage, 1954</a>)</span> or “personal” probability distribution over states of the world and a utility function.</p>
</section>
<section id="reflection" class="level1">
<h1>Reflection</h1>
<section id="critiques-and-limitations" class="level2">
<h2 class="anchored" data-anchor-id="critiques-and-limitations">Critiques and limitations</h2>
<ul>
<li>Simple idea:
<ul>
<li>Add up all the costs</li>
<li>Add up all the benefits</li>
</ul></li>
<li>Sometimes it’s hard to combine different things that we care about into a single number!
<ul>
<li>Cost and safety</li>
<li>Impacts on different groups of people</li>
<li>We will revisit this in the context of multi-criteria decision analysis.</li>
</ul></li>
<li>In practice, this often leads us to care only about costs and benefits that are easy to quantify / monetize
<ul>
<li>Value of ecosystems?</li>
</ul></li>
<li>The limitations of discounting are especially relevant for some types of climate adaptation decisions
<ul>
<li>We will revisit this on Wednesday</li>
</ul></li>
<li>We often deal with “deep” uncertainties for which it’s hard to come up with a probability distribution
<ul>
<li>We will revisit this much later in the semester</li>
</ul></li>
<li>Is Bayesian decision theory a good model of how people actually make decisions?
<ul>
<li>This framework was largely formalized by <span class="citation" data-cites="savage:1954">Savage (<a href="#ref-savage:1954" role="doc-biblioref">1954</a>)</span>, who postulated that people often behave as though maximizing expected utility</li>
<li><span class="citation" data-cites="ellsberg_ambiguity:1961">Ellsberg (<a href="#ref-ellsberg_ambiguity:1961" role="doc-biblioref">1961</a>)</span> and others: this is not how people really make decisions!</li>
<li>Our goal is to <strong>support</strong> decision-making, not <strong>predict</strong> how people will actually make decisions. So the fact that this is not how people actually make decisions is not a problem for us.</li>
<li>That said: when our predictions of “what is rational” diverge from what people actually do, we should be curious about why instead of assuming they are stupid!</li>
</ul></li>
</ul>
</section>
<section id="a-defense" class="level2">
<h2 class="anchored" data-anchor-id="a-defense">A defense</h2>
<p>Cost-benefit analysis is still useful when applied thoughtfully.</p>
<ul>
<li>It forces us to be explicit about our assumptions
<ul>
<li>What we care about and how we are measuring it</li>
<li>What we are ignoring</li>
<li>How we think about uncertainty</li>
</ul></li>
<li>Allows an apples-to-apples comparison of different decisions</li>
</ul>
<p>Ultimately, cost-benefit analysis is a great decision-support tool, but it is not a decision-making tool. When applied well, it’s an iterative process through which we repeatedly refine our understanding of the decision problem. When applied poorly, it’s a black-box process that spits out a number that is used to justify a decision that was already made.</p>
</section>
</section>
<section id="next-steps" class="level1">
<h1>Next steps</h1>
<section id="wednesday" class="level2">
<h2 class="anchored" data-anchor-id="wednesday">Wednesday</h2>
<p>Digging a bit deeper:</p>
<ul>
<li>Discount rates for problems with long time horizons <span class="citation" data-cites="arrow_discount:2013">(<a href="#ref-arrow_discount:2013" role="doc-biblioref">Arrow et al., 2013</a>)</span></li>
<li>Applications of cost-benefit analysis
<ul>
<li>Social cost of carbon</li>
<li>Army Corps of Engineers projects</li>
<li>EPA regulations</li>
</ul></li>
</ul>
</section>
<section id="thursday" class="level2">
<h2 class="anchored" data-anchor-id="thursday">Thursday</h2>
<p>Lab: implementing a simple cost-benefit analysis for house elevation.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-arrow_discount:2013" class="csl-entry" role="listitem">
Arrow, K., Cropper, M., Gollier, C., Groom, B., Heal, G., Newell, R., et al. (2013). Determining benefits and costs for future generations. <em>Science</em>, <em>341</em>(6144), 349–350. <a href="https://doi.org/10.1126/science.1235665">https://doi.org/10.1126/science.1235665</a>
</div>
<div id="ref-ellsberg_ambiguity:1961" class="csl-entry" role="listitem">
Ellsberg, D. (1961). Risk, ambiguity, and the <span>Savage</span> axioms. <em>The Quarterly Journal of Economics</em>, <em>75</em>(4), 643–669. <a href="https://doi.org/10.2307/1884324">https://doi.org/10.2307/1884324</a>
</div>
<div id="ref-savage:1954" class="csl-entry" role="listitem">
Savage, L. J. (1954). <em>Foundations of statistics.</em> <span>New York</span>: <span>Wiley</span>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Content <i class="fa-solid fa-copyright" aria-label="copyright"></i> 2024 by <a href="https://jamesdossgollin.me">James Doss-Gollin</a>. All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license (CC BY-NC-SA 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
<p><strong>Page still under construction.</strong></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://www.github.com/ceve-421-521/ceve-421-521.github.io/edit/main/lectures/05-bca.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://www.github.com/ceve-421-521/ceve-421-521.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Made with <a href="https://julialang.org">Julia</a> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/ceve543/ceve543.github.io">View the source on <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>